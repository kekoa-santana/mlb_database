{
  "Comment": "Multi‚Äêyear MLB backfill, one day per iteration",
  "StartAt": "MapOverDates",
  "States": {
    "MapOverDates": {
      "Type": "Map",
      "ItemsPath": "$.dates",
      "MaxConcurrency": 5,
      "Iterator": {
        "StartAt": "BackfillOneDay",
        "States": {
          "BackfillOneDay": {
            "Type": "Task",
            "Resource": "arn:aws:lambda:us-east-2:227271426748:function:mlb-deps-ecr",
            "TimeoutSeconds": 900,
            "Parameters": {
              "mode": "historical_raw",
              "start_date.$": "$$.Map.Item.Value",
              "end_date.$":   "$$.Map.Item.Value"
            },
            "Retry": [{
              "ErrorEquals":   ["States.ALL"],
              "IntervalSeconds": 30,
              "MaxAttempts":     2,
              "BackoffRate":     2.0
            }],
            "Catch": [{
              "ErrorEquals": ["States.ALL"],
              "ResultPath":  "$.errorInfo",
              "Next":        "RecordFailure"
            }],
            "End": true
          },
          "RecordFailure": {
            "Type": "Pass",
            "Parameters": {
              "failedDate.$": "$$.Map.Item.Value",
              "error.$":      "$.errorInfo"
            },
            "ResultPath": "$.failures[0]",
            "End": true
          }
        }
      },
      "End": true
    }
  }
}
